{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Container = void 0;\n\nconst tslib_1 = require(\"tslib\");\n\nconst Canvas_1 = require(\"./Canvas\");\n\nconst Particles_1 = require(\"./Particles\");\n\nconst Retina_1 = require(\"./Retina\");\n\nconst FrameManager_1 = require(\"./FrameManager\");\n\nconst Options_1 = require(\"../Options/Classes/Options\");\n\nconst Utils_1 = require(\"../Utils\");\n\nclass Container {\n  constructor(id, sourceOptions, ...presets) {\n    this.id = id;\n    this.sourceOptions = sourceOptions;\n    this.started = false;\n    this.destroyed = false;\n    this.paused = true;\n    this.lastFrameTime = 0;\n    this.pageHidden = false;\n    this.retina = new Retina_1.Retina(this);\n    this.canvas = new Canvas_1.Canvas(this);\n    this.particles = new Particles_1.Particles(this);\n    this.drawer = new FrameManager_1.FrameManager(this);\n    this.noise = {\n      generate: () => {\n        return {\n          angle: Math.random() * Math.PI * 2,\n          length: Math.random()\n        };\n      },\n      init: () => {},\n      update: () => {}\n    };\n    this.interactivity = {\n      mouse: {\n        clicking: false,\n        inside: false\n      }\n    };\n    this.bubble = {};\n    this.repulse = {\n      particles: []\n    };\n    this.attract = {\n      particles: []\n    };\n    this.plugins = new Map();\n    this.drawers = new Map();\n    this.density = 1;\n    this.options = new Options_1.Options();\n\n    for (const preset of presets) {\n      this.options.load(Utils_1.Plugins.getPreset(preset));\n    }\n\n    const shapes = Utils_1.Plugins.getSupportedShapes();\n\n    for (const type of shapes) {\n      const drawer = Utils_1.Plugins.getShapeDrawer(type);\n\n      if (drawer) {\n        this.drawers.set(type, drawer);\n      }\n    }\n\n    if (this.sourceOptions) {\n      this.options.load(this.sourceOptions);\n    }\n\n    this.eventListeners = new Utils_1.EventListeners(this);\n  }\n\n  play(force) {\n    const needsUpdate = this.paused || force;\n\n    if (this.paused) {\n      this.paused = false;\n    }\n\n    if (needsUpdate) {\n      for (const [, plugin] of this.plugins) {\n        if (plugin.play) {\n          plugin.play();\n        }\n      }\n\n      this.lastFrameTime = performance.now();\n    }\n\n    this.draw();\n  }\n\n  pause() {\n    if (this.drawAnimationFrame !== undefined) {\n      Utils_1.Utils.cancelAnimation(this.drawAnimationFrame);\n      delete this.drawAnimationFrame;\n    }\n\n    if (this.paused) {\n      return;\n    }\n\n    for (const [, plugin] of this.plugins) {\n      if (plugin.pause) {\n        plugin.pause();\n      }\n    }\n\n    if (!this.pageHidden) {\n      this.paused = true;\n    }\n  }\n\n  draw() {\n    this.drawAnimationFrame = Utils_1.Utils.animate(t => this.drawer.nextFrame(t));\n  }\n\n  getAnimationStatus() {\n    return !this.paused;\n  }\n\n  setNoise(noiseOrGenerator, init, update) {\n    if (!noiseOrGenerator) {\n      return;\n    }\n\n    if (typeof noiseOrGenerator === \"function\") {\n      this.noise.generate = noiseOrGenerator;\n\n      if (init) {\n        this.noise.init = init;\n      }\n\n      if (update) {\n        this.noise.update = update;\n      }\n    } else {\n      if (noiseOrGenerator.generate) {\n        this.noise.generate = noiseOrGenerator.generate;\n      }\n\n      if (noiseOrGenerator.init) {\n        this.noise.init = noiseOrGenerator.init;\n      }\n\n      if (noiseOrGenerator.update) {\n        this.noise.update = noiseOrGenerator.update;\n      }\n    }\n  }\n\n  densityAutoParticles() {\n    this.initDensityFactor();\n    const numberOptions = this.options.particles.number;\n    const optParticlesNumber = numberOptions.value;\n    const optParticlesLimit = numberOptions.limit > 0 ? numberOptions.limit : optParticlesNumber;\n    const particlesNumber = Math.min(optParticlesNumber, optParticlesLimit) * this.density;\n    const particlesCount = this.particles.count;\n\n    if (particlesCount < particlesNumber) {\n      this.particles.push(Math.abs(particlesNumber - particlesCount));\n    } else if (particlesCount > particlesNumber) {\n      this.particles.removeQuantity(particlesCount - particlesNumber);\n    }\n  }\n\n  destroy() {\n    this.stop();\n    this.canvas.destroy();\n\n    for (const [, drawer] of this.drawers) {\n      if (drawer.destroy) {\n        drawer.destroy(this);\n      }\n    }\n\n    this.drawers = new Map();\n    this.destroyed = true;\n  }\n\n  exportImg(callback) {\n    this.exportImage(callback);\n  }\n\n  exportImage(callback, type, quality) {\n    var _a;\n\n    return (_a = this.canvas.element) === null || _a === void 0 ? void 0 : _a.toBlob(callback, type !== null && type !== void 0 ? type : \"image/png\", quality);\n  }\n\n  exportConfiguration() {\n    return JSON.stringify(this.options, undefined, 2);\n  }\n\n  refresh() {\n    return tslib_1.__awaiter(this, void 0, void 0, function* () {\n      this.stop();\n      yield this.start();\n    });\n  }\n\n  stop() {\n    if (!this.started) {\n      return;\n    }\n\n    this.started = false;\n    this.eventListeners.removeListeners();\n    this.pause();\n    this.particles.clear();\n    this.canvas.clear();\n\n    for (const [, plugin] of this.plugins) {\n      if (plugin.stop) {\n        plugin.stop();\n      }\n    }\n\n    this.plugins = new Map();\n    this.particles.linksColors = new Map();\n    delete this.particles.grabLineColor;\n    delete this.particles.linksColor;\n  }\n\n  start() {\n    return tslib_1.__awaiter(this, void 0, void 0, function* () {\n      if (this.started) {\n        return;\n      }\n\n      yield this.init();\n      this.started = true;\n      this.eventListeners.addListeners();\n\n      for (const [, plugin] of this.plugins) {\n        if (plugin.startAsync !== undefined) {\n          yield plugin.startAsync();\n        } else if (plugin.start !== undefined) {\n          plugin.start();\n        }\n      }\n\n      this.play();\n    });\n  }\n\n  init() {\n    return tslib_1.__awaiter(this, void 0, void 0, function* () {\n      this.retina.init();\n      this.canvas.init();\n      const availablePlugins = Utils_1.Plugins.getAvailablePlugins(this);\n\n      for (const [id, plugin] of availablePlugins) {\n        this.plugins.set(id, plugin);\n      }\n\n      for (const [, drawer] of this.drawers) {\n        if (drawer.init) {\n          yield drawer.init(this);\n        }\n      }\n\n      for (const [, plugin] of this.plugins) {\n        if (plugin.init) {\n          plugin.init(this.options);\n        } else if (plugin.initAsync !== undefined) {\n          yield plugin.initAsync(this.options);\n        }\n      }\n\n      this.particles.init();\n      this.densityAutoParticles();\n    });\n  }\n\n  initDensityFactor() {\n    const densityOptions = this.options.particles.number.density;\n\n    if (!this.canvas.element || !densityOptions.enable) {\n      return;\n    }\n\n    const canvas = this.canvas.element;\n    const pxRatio = this.retina.pixelRatio;\n    this.density = canvas.width * canvas.height / (densityOptions.factor * pxRatio * densityOptions.area);\n  }\n\n}\n\nexports.Container = Container;","map":null,"metadata":{},"sourceType":"script"}